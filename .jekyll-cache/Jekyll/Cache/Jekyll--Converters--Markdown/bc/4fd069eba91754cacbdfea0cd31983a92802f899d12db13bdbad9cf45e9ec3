I"Òa<h4 id="å¹²è´§">å¹²è´§</h4>
<p>SpringMVCè§£æå™¨ç”¨äºè§£ærequestè¯·æ±‚å‚æ•°å¹¶ç»‘å®šæ•°æ®åˆ°Controllerçš„å…¥å‚ä¸Šã€‚
è‡ªå®šä¹‰ä¸€ä¸ªå‚æ•°è§£æå™¨éœ€è¦å®ç°HandlerMethodArgumentResolveræ¥å£ï¼Œé‡å†™supportsParameterå’ŒresolveArgumentæ–¹æ³•ï¼Œé…ç½®æ–‡ä»¶ä¸­åŠ å…¥resolveré…ç½®ã€‚
å¦‚æœéœ€è¦å¤šä¸ªè§£æå™¨åŒæ—¶ç”Ÿæ•ˆéœ€è¦åœ¨ä¸€ä¸ªè§£æå™¨ä¸­å¯¹å…¶ä»–è§£æå™¨åšå…¼å®¹</p>
<h4 id="ç¼˜èµ·">ç¼˜èµ·</h4>
<p>ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ä¸€ä¸ªè§£æå™¨å‘¢ï¼Ÿ</p>

<p>æºäºéœ€è¦å¯¹å‰ç«¯è¯·æ±‚å‚æ•°è¿›è¡Œæ‰‹åŠ¨URLDecodeï¼Œä¹Ÿå³é™¤äº†Webå®¹å™¨è‡ªåŠ¨decodeä¸€æ¬¡ï¼Œä»£ç å†…è¿˜éœ€è¦å†decodeä¸€æ¬¡ã€‚</p>

<p>é’ˆå¯¹è¿™ç§éœ€æ±‚ï¼Œé¦–å…ˆæƒ³åˆ°çš„æ˜¯filteræˆ–è€…interceptorå®ç°ï¼Œä½†æ˜¯ç”±äºHttpServletRequestå¯¹è±¡æœ¬èº«æ˜¯ä¸æä¾›setParameter()æ–¹æ³•çš„ï¼Œå› æ­¤æƒ³è¦ä¿®æ”¹requestä¸­çš„å‚æ•°å€¼ä¸ºdecodeåçš„å€¼æ˜¯ä¸æ˜“è¾¾åˆ°çš„ã€‚</p>

<p>SpringMVCçš„HandlerMethodArgumentResolverï¼Œè§£æå™¨ï¼›å…¶åŠŸèƒ½å°±æ˜¯è§£ærequestè¯·æ±‚å‚æ•°å¹¶ç»‘å®šæ•°æ®åˆ°Controllerçš„å…¥å‚ä¸Šã€‚å› æ­¤è‡ªå®šä¹‰è§£æå™¨åŠ å…¥URLDecodeé€»è¾‘å³å¯å®Œå…¨æ»¡è¶³éœ€æ±‚ã€‚</p>

<p>ä¸‹é¢ï¼Œå°±ä¸€æ­¥ä¸€æ­¥çš„å®Œæˆä¸€ä¸ªè§£æå™¨ç”±ç®€åˆ°ç¹çš„å®ç°è¿‡ç¨‹ã€‚</p>

<h4 id="å®ç°ä¸€ä¸ªæå…¶ç®€å•çš„å‚æ•°è§£æå™¨">å®ç°ä¸€ä¸ªæå…¶ç®€å•çš„å‚æ•°è§£æå™¨</h4>
<p>å…·ä½“å¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ªå‚æ•°è§£æå™¨å‘¢ï¼Ÿ</p>

<p>å…¶å®å¾ˆç®€å•ï¼Œä¸€å¥è¯â€”â€”å®ç°HandlerMethodArgumentResolveræ¥å£ï¼Œé‡å†™supportsParameterå’ŒresolveArgumentæ–¹æ³•ï¼Œé…ç½®æ–‡ä»¶ä¸­åŠ å…¥resolveré…ç½®ã€‚</p>

<p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>

<ul>
  <li>è‡ªå®šä¹‰è§£æå™¨å®ç°</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyArgumentsResolver</span> <span class="kd">implements</span> <span class="nc">HandlerMethodArgumentResolver</span> <span class="o">{</span>
    <span class="cm">/**
     * è§£æå™¨æ˜¯å¦æ”¯æŒå½“å‰å‚æ•°
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">supportsParameter</span><span class="o">(</span><span class="nc">MethodParameter</span> <span class="n">parameter</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// æŒ‡å®šå‚æ•°å¦‚æœè¢«åº”ç”¨MyParamæ³¨è§£ï¼Œåˆ™ä½¿ç”¨è¯¥è§£æå™¨ã€‚</span>
        <span class="c1">// å¦‚æœç›´æ¥è¿”å›trueï¼Œåˆ™ä»£è¡¨å°†æ­¤è§£æå™¨ç”¨äºæ‰€æœ‰å‚æ•°</span>
        <span class="k">return</span> <span class="n">parameter</span><span class="o">.</span><span class="na">hasParameterAnnotation</span><span class="o">(</span><span class="nc">MyParam</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
     * å°†requestä¸­çš„è¯·æ±‚å‚æ•°è§£æåˆ°å½“å‰Controllerå‚æ•°ä¸Š
     * @param parameter éœ€è¦è¢«è§£æçš„Controllerå‚æ•°ï¼Œæ­¤å‚æ•°å¿…é¡»é¦–å…ˆä¼ ç»™{@link #supportsParameter}å¹¶è¿”å›true
     * @param mavContainer å½“å‰requestçš„ModelAndViewContainer
     * @param webRequest å½“å‰request
     * @param binderFactory ç”Ÿæˆ{@link WebDataBinder}å®ä¾‹çš„å·¥å‚
     * @return è§£æåçš„Controllerå‚æ•°
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">resolveArgument</span><span class="o">(</span><span class="nc">MethodParameter</span> <span class="n">parameter</span><span class="o">,</span> <span class="nc">ModelAndViewContainer</span> <span class="n">mavContainer</span><span class="o">,</span>
                                  <span class="nc">NativeWebRequest</span> <span class="n">webRequest</span><span class="o">,</span> <span class="nc">WebDataBinderFactory</span> <span class="n">binderFactory</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<ul>
  <li>è‡ªå®šä¹‰æ³¨è§£</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Target</span><span class="o">({</span><span class="nc">ElementType</span><span class="o">.</span><span class="na">PARAMETER</span><span class="o">})</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="nc">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
<span class="nd">@Documented</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">MyParam</span> <span class="o">{</span>
<span class="o">}</span>
</code></pre></div></div>
<ul>
  <li>åœ¨springmvcé…ç½®æ–‡ä»¶ä¸­æ³¨å†Œè§£æå™¨
```java</li>
</ul>
<mvc:annotation-driven>
        <!--MyArgumentsResolver-->
        <mvc:argument-resolvers>
            <bean class="xxx.xxx.xxx.MyArgumentsResolver" />
        </mvc:argument-resolvers>
</mvc:annotation-driven>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
å¥½äº†ï¼Œç°åœ¨è§£æå™¨ä¼šæŠŠæ‰€æœ‰åº”ç”¨äº†@MyParamæ³¨è§£çš„å‚æ•°éƒ½èµ‹å€¼ä¸ºnullã€‚

#### å®ç°ä¸€ä¸ªè§£æåŸå§‹ç±»å‹çš„å‚æ•°è§£æå™¨
å¯¹äºå¦‚ä½•è§£æåŸå§‹ç±»å‹å‚æ•°ï¼ŒSpringMVCå·²ç»æœ‰äº†ä¸€ä¸ªå†…ç½®çš„å®ç°â€”â€”RequestParamMethodArgumentResolverï¼Œå› æ­¤å®Œå…¨å¯ä»¥å‚è€ƒè¿™ä¸ªå®ç°æ¥è‡ªå®šä¹‰æˆ‘ä»¬è‡ªå·±çš„è§£æå™¨ã€‚

å¦‚ä¸Šæ‰€è¿°ï¼Œè§£æå™¨é€»è¾‘çš„ä¸»è¦éƒ¨åˆ†éƒ½åœ¨resolveArgumentæ–¹æ³•å†…ï¼Œè¿™é‡Œå°±è¯´è¯´è‡ªå®šä¹‰è¯¥æ–¹æ³•çš„å®ç°ã€‚
```java
@Override
public Object resolveArgument(MethodParameter parameter, ModelAndViewContainer mavContainer,
                              NativeWebRequest webRequest, WebDataBinderFactory binderFactory) throws Exception {

    // è§£æå™¨ä¸­çš„è‡ªå®šä¹‰é€»è¾‘â€”â€”urldecode
    Object arg = URLDecoder.decode(webRequest.getParameter(parameter.getParameterName()), "UTF-8");

    // å°†è§£æåçš„å€¼ç»‘å®šåˆ°å¯¹åº”çš„Controllerå‚æ•°ä¸Šï¼Œåˆ©ç”¨DataBinderæä¾›çš„æ–¹æ³•ä¾¿æ·çš„å®ç°ç±»å‹è½¬æ¢
    if (binderFactory != null) {

        // ç”Ÿæˆå‚æ•°ç»‘å®šå™¨ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºrequestè¯·æ±‚å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºéœ€è¦ç»‘å®šçš„ç›®æ ‡å¯¹è±¡ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºéœ€è¦ç»‘å®šçš„ç›®æ ‡å¯¹è±¡å
        WebDataBinder binder = binderFactory.createBinder(webRequest, null, parameter.getParameterName());

        try {

            // å°†å‚æ•°è½¬åˆ°é¢„æœŸç±»å‹ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè§£æåçš„å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºç»‘å®šControllerå‚æ•°çš„ç±»å‹ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºç»‘å®šçš„Controllerå‚æ•°
            arg = binder.convertIfNecessary(arg, parameter.getParameterType(), parameter);

        } catch (ConversionNotSupportedException ex) {
            throw new MethodArgumentConversionNotSupportedException(arg, ex.getRequiredType(),
                    parameter.getParameterName(), parameter, ex.getCause());
        } catch (TypeMismatchException ex) {
            throw new MethodArgumentTypeMismatchException(arg, ex.getRequiredType(),
                    parameter.getParameterName(), parameter, ex.getCause());
        }
    }
    return arg;
}
</code></pre></div></div>
<h4 id="æ·»åŠ è§£æå¯¹è±¡ç±»å‹å‚æ•°çš„åŠŸèƒ½">æ·»åŠ è§£æå¯¹è±¡ç±»å‹å‚æ•°çš„åŠŸèƒ½</h4>
<p>å¯¹äºå¦‚ä½•è§£æå¯¹è±¡ç±»å‹å‚æ•°ï¼ŒSpringMVCå†…ä¹Ÿæœ‰äº†ä¸€ä¸ªå†…ç½®çš„å®ç°â€”â€”ModelAttributeMethodProcessorï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯å‚è€ƒè¿™ä¸ªå®ç°æ¥è‡ªå®šä¹‰æˆ‘ä»¬è‡ªå·±çš„è§£æå™¨ã€‚</p>

<p>åŒæ ·ï¼ŒresolveArgumentæ–¹æ³•ç¤ºä¾‹å¦‚ä¸‹</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="nc">Object</span> <span class="nf">resolveArgument</span><span class="o">(</span><span class="nc">MethodParameter</span> <span class="n">parameter</span><span class="o">,</span> <span class="nc">ModelAndViewContainer</span> <span class="n">mavContainer</span><span class="o">,</span>
                              <span class="nc">NativeWebRequest</span> <span class="n">webRequest</span><span class="o">,</span> <span class="nc">WebDataBinderFactory</span> <span class="n">binderFactory</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

    <span class="nc">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">parameter</span><span class="o">.</span><span class="na">getParameterName</span><span class="o">();</span>

    <span class="c1">// æŸ¥æ‰¾æ˜¯å¦å·²æœ‰åä¸ºnameçš„å‚æ•°å€¼çš„æ˜ å°„ï¼Œå¦‚æœæ²¡æœ‰åˆ™åˆ›å»ºä¸€ä¸ª</span>
    <span class="nc">Object</span> <span class="n">attribute</span> <span class="o">=</span> <span class="n">mavContainer</span><span class="o">.</span><span class="na">containsAttribute</span><span class="o">(</span><span class="n">name</span><span class="o">)</span>
        <span class="o">?</span> <span class="n">mavContainer</span><span class="o">.</span><span class="na">getModel</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">)</span>
        <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">createAttribute</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">parameter</span><span class="o">,</span> <span class="n">binderFactory</span><span class="o">,</span> <span class="n">webRequest</span><span class="o">);</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">binderFactory</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">WebDataBinder</span> <span class="n">binder</span> <span class="o">=</span> <span class="n">binderFactory</span><span class="o">.</span><span class="na">createBinder</span><span class="o">(</span><span class="n">webRequest</span><span class="o">,</span> <span class="n">attribute</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">binder</span><span class="o">.</span><span class="na">getTarget</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// è¿›è¡Œå‚æ•°ç»‘å®š</span>
            <span class="k">this</span><span class="o">.</span><span class="na">bindRequestParameters</span><span class="o">(</span><span class="n">binder</span><span class="o">,</span> <span class="n">webRequest</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">// å°†å‚æ•°è½¬åˆ°é¢„æœŸç±»å‹ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè§£æåçš„å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºç»‘å®šControllerå‚æ•°çš„ç±»å‹ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºç»‘å®šçš„Controllerå‚æ•°</span>
        <span class="n">attribute</span> <span class="o">=</span> <span class="n">binder</span><span class="o">.</span><span class="na">convertIfNecessary</span><span class="o">(</span><span class="n">binder</span><span class="o">.</span><span class="na">getTarget</span><span class="o">(),</span> <span class="n">parameter</span><span class="o">.</span><span class="na">getParameterType</span><span class="o">(),</span> <span class="n">parameter</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="k">return</span> <span class="n">attribute</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">bindRequestParameters</span><span class="o">(</span><span class="nc">WebDataBinder</span> <span class="n">binder</span><span class="o">,</span> <span class="nc">NativeWebRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">UnsupportedEncodingException</span> <span class="o">{</span>
    <span class="c1">// å°†key-valueå°è£…ä¸ºmapï¼Œä¼ ç»™bindæ–¹æ³•è¿›è¡Œå‚æ•°å€¼ç»‘å®š</span>
    <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
    <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">[]&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameterMap</span><span class="o">();</span>

    <span class="k">for</span> <span class="o">(</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">[]&gt;</span> <span class="n">entry</span> <span class="o">:</span> <span class="n">params</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">();</span>
        <span class="c1">// æ‰§è¡Œurldecode</span>
        <span class="nc">String</span> <span class="n">value</span> <span class="o">=</span> <span class="nc">URLDecoder</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">()[</span><span class="mi">0</span><span class="o">],</span> <span class="s">"UTF-8"</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nc">PropertyValues</span> <span class="n">propertyValues</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MutablePropertyValues</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>

    <span class="c1">// å°†K-Vç»‘å®šåˆ°binder.targetå±æ€§ä¸Š</span>
    <span class="n">binder</span><span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="n">propertyValues</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>
<h4 id="åŒæ—¶æ”¯æŒå¤šä¸ªå‚æ•°è§£æå™¨ç”Ÿæ•ˆ">åŒæ—¶æ”¯æŒå¤šä¸ªå‚æ•°è§£æå™¨ç”Ÿæ•ˆ</h4>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸è®ºå¯¹äºåŸå§‹ç±»å‹æˆ–è€…å¯¹è±¡ç±»å‹çš„å‚æ•°ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªå‚æ•°è§£æå™¨äº†ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªå¾ˆä¸¥é‡çš„é—®é¢˜å­˜åœ¨â€”â€”æ— æ³•è®©è‡ªå®šä¹‰è§£æå™¨å’Œç°æœ‰è§£æå™¨åŒæ—¶ç”Ÿæ•ˆã€‚</p>

<p>ä¸¾ä¸ªä¾‹å­ï¼Œpublic String myController(@Valid @MyParam param, BindingResult result){}ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œæ—¶æ˜¯ä¼šæŠ¥é”™çš„ã€‚ä»–ä¼šæç¤ºç±»ä¼¼å¦‚ä¸‹æŠ¥é”™ï¼š</p>

<p>An Errors/BindingResult argument is expected to be declared immediately after the model attribute, the @RequestBody or the @RequestPart arguments</p>

<p>æ˜¯SpringMVCä¸æ”¯æŒåŒæ—¶ä½¿ç”¨ä¸¤ä¸ªè§£æå™¨å—ï¼Ÿpublic String myController(@Valid @ModelAttribute param, BindingResult result){}ï¼Œä¹Ÿæ˜¯ä¸¤ä¸ªå†…ç½®è§£æå™¨ï¼Œæ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚</p>

<p>å†å»çœ‹ModelAttributeMethodProcessorçš„å®ç°ï¼ŒåŸæ¥æ˜¯å¯¹@Validåšäº†å…¼å®¹å¤„ç†ã€‚</p>

<p>å› æ­¤ï¼Œ <strong>å¦‚æœéœ€è¦å¤šä¸ªè§£æå™¨åŒæ—¶ç”Ÿæ•ˆéœ€è¦åœ¨ä¸€ä¸ªè§£æå™¨ä¸­å¯¹å…¶ä»–è§£æå™¨åšå…¼å®¹ã€‚</strong></p>

<p>è¿™é‡Œä»…ä»¥å¯¹@Validè¿›è¡Œå…¼å®¹å¤„ç†ä¸ºä¾‹ï¼Œåœ¨è§£æå¯¹è±¡ç±»å‹çš„è§£æå™¨å®ç°ä¸­è¿›è¡Œä¿®æ”¹</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="nc">Object</span> <span class="nf">resolveArgument</span><span class="o">(</span><span class="nc">MethodParameter</span> <span class="n">parameter</span><span class="o">,</span> <span class="nc">ModelAndViewContainer</span> <span class="n">mavContainer</span><span class="o">,</span>
                              <span class="nc">NativeWebRequest</span> <span class="n">webRequest</span><span class="o">,</span> <span class="nc">WebDataBinderFactory</span> <span class="n">binderFactory</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

    <span class="nc">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">parameter</span><span class="o">.</span><span class="na">getParameterName</span><span class="o">();</span>

    <span class="c1">// æŸ¥æ‰¾æ˜¯å¦å·²æœ‰åä¸ºnameçš„å‚æ•°å€¼çš„æ˜ å°„ï¼Œå¦‚æœæ²¡æœ‰åˆ™åˆ›å»ºä¸€ä¸ª</span>
    <span class="nc">Object</span> <span class="n">attribute</span> <span class="o">=</span> <span class="n">mavContainer</span><span class="o">.</span><span class="na">containsAttribute</span><span class="o">(</span><span class="n">name</span><span class="o">)</span>
        <span class="o">?</span> <span class="n">mavContainer</span><span class="o">.</span><span class="na">getModel</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">)</span>
        <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">createAttribute</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">parameter</span><span class="o">,</span> <span class="n">binderFactory</span><span class="o">,</span> <span class="n">webRequest</span><span class="o">);</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">binderFactory</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">WebDataBinder</span> <span class="n">binder</span> <span class="o">=</span> <span class="n">binderFactory</span><span class="o">.</span><span class="na">createBinder</span><span class="o">(</span><span class="n">webRequest</span><span class="o">,</span> <span class="n">attribute</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">binder</span><span class="o">.</span><span class="na">getTarget</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// è¿›è¡Œå‚æ•°ç»‘å®šï¼Œæ­¤æ–¹æ³•å®ç°ä¸å†èµ˜è¿°ï¼Œå¯åˆ°ä¸ŠèŠ‚æŸ¥çœ‹</span>
            <span class="k">this</span><span class="o">.</span><span class="na">bindRequestParameters</span><span class="o">(</span><span class="n">binder</span><span class="o">,</span> <span class="n">webRequest</span><span class="o">);</span>

<span class="c1">// -----------------------------------å¯¹@Validåšå…¼å®¹----------------------------------------------------</span>

            <span class="c1">// å¦‚æœä½¿ç”¨äº†validationæ ¡éªŒ, åˆ™è¿›è¡Œç›¸åº”æ ¡éªŒ</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">parameter</span><span class="o">.</span><span class="na">hasParameterAnnotation</span><span class="o">(</span><span class="nc">Valid</span><span class="o">.</span><span class="na">class</span><span class="o">))</span> <span class="o">{</span>
                <span class="c1">// å¦‚æœæœ‰æ ¡éªŒæŠ¥é”™ï¼Œä¼šå°†ç»“æœæ”¾åœ¨binder.bindingResultå±æ€§ä¸­</span>
                <span class="n">binder</span><span class="o">.</span><span class="na">validate</span><span class="o">();</span>
            <span class="o">}</span>

            <span class="c1">// å¦‚æœå‚æ•°ä¸­ä¸åŒ…å«BindingResultå‚æ•°ï¼Œç›´æ¥æŠ›å‡ºå¼‚å¸¸</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">binder</span><span class="o">.</span><span class="na">getBindingResult</span><span class="o">().</span><span class="na">hasErrors</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">isBindExceptionRequired</span><span class="o">(</span><span class="n">binder</span><span class="o">,</span> <span class="n">parameter</span><span class="o">))</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">BindException</span><span class="o">(</span><span class="n">binder</span><span class="o">.</span><span class="na">getBindingResult</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="c1">// å…³é”®,ä½¿Controllerä¸­æ¥ä¸‹æ¥çš„BindingResultå‚æ•°å¯ä»¥æ¥æ”¶å¼‚å¸¸</span>
        <span class="nc">Map</span> <span class="n">bindingResultModel</span> <span class="o">=</span> <span class="n">binder</span><span class="o">.</span><span class="na">getBindingResult</span><span class="o">().</span><span class="na">getModel</span><span class="o">();</span>
        <span class="n">mavContainer</span><span class="o">.</span><span class="na">removeAttributes</span><span class="o">(</span><span class="n">bindingResultModel</span><span class="o">);</span>
        <span class="n">mavContainer</span><span class="o">.</span><span class="na">addAllAttributes</span><span class="o">(</span><span class="n">bindingResultModel</span><span class="o">);</span>

<span class="c1">// -----------------------------------å¯¹@Validåšå…¼å®¹----------------------------------------------------</span>

        <span class="c1">// å°†å‚æ•°è½¬åˆ°é¢„æœŸç±»å‹ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè§£æåçš„å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºç»‘å®šControllerå‚æ•°çš„ç±»å‹ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºç»‘å®šçš„Controllerå‚æ•°</span>
        <span class="n">attribute</span> <span class="o">=</span> <span class="n">binder</span><span class="o">.</span><span class="na">convertIfNecessary</span><span class="o">(</span><span class="n">binder</span><span class="o">.</span><span class="na">getTarget</span><span class="o">(),</span> <span class="n">parameter</span><span class="o">.</span><span class="na">getParameterType</span><span class="o">(),</span> <span class="n">parameter</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="k">return</span> <span class="n">attribute</span><span class="o">;</span>
<span class="o">}</span>

<span class="cm">/**
 * æ£€æŸ¥å‚æ•°ä¸­æ˜¯å¦åŒ…å«BindingResultå‚æ•°
 */</span>
<span class="kd">protected</span> <span class="kt">boolean</span> <span class="nf">isBindExceptionRequired</span><span class="o">(</span><span class="nc">WebDataBinder</span> <span class="n">binder</span><span class="o">,</span> <span class="nc">MethodParameter</span> <span class="n">methodParam</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">methodParam</span><span class="o">.</span><span class="na">getParameterIndex</span><span class="o">();</span>
    <span class="nc">Class</span><span class="o">[]</span> <span class="n">paramTypes</span> <span class="o">=</span> <span class="n">methodParam</span><span class="o">.</span><span class="na">getMethod</span><span class="o">().</span><span class="na">getParameterTypes</span><span class="o">();</span>
    <span class="kt">boolean</span> <span class="n">hasBindingResult</span> <span class="o">=</span> <span class="n">paramTypes</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nc">Errors</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">isAssignableFrom</span><span class="o">(</span><span class="n">paramTypes</span><span class="o">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">]);</span>
    <span class="k">return</span> <span class="o">!</span><span class="n">hasBindingResult</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>
<p>OKï¼Œåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬è‡ªå®šä¹‰çš„è§£æå™¨å·²ç»å¯ä»¥ç®—æ˜¯ä¸€ä¸ªå®Œå–„çš„å‚æ•°è§£æå™¨äº†ï¼Œå¦‚æœæœ‰å¯¹å…¶ä»–è§£æå™¨åšå…¼å®¹çš„éœ€è¦ï¼Œåªè¦å‚ç…§æ­¤ç±»æ–¹æ³•ç¨ä½œä¿®æ”¹å³å¯ã€‚</p>

<h4 id="åè®°">åè®°</h4>
<p>è¿˜è®°å¾—è¿™æ¬¡è‡ªå®šä¹‰è§£æå™¨çš„åŸå› å—â€”â€”éœ€è¦å¯¹å‰ç«¯è¯·æ±‚å‚æ•°è¿›è¡Œæ‰‹åŠ¨URLDecodeï¼Œä¹Ÿå³é™¤äº†Webå®¹å™¨è‡ªåŠ¨decodeä¸€æ¬¡ï¼Œä»£ç å†…è¿˜éœ€è¦å†decodeä¸€æ¬¡ã€‚</p>

<p>äº‹å®è¯æ˜ï¼Œæ ¹æœ¬ä¸éœ€è¦è¿›è¡ŒäºŒæ¬¡decodeï¼Œå†™å‡ºçš„è§£æå™¨ä¹Ÿå°±æ— ç–¾è€Œç»ˆäº†ï¼Œä»…å­˜è¿™ç¯‡æ•´ç†ï¼Œç®—æ˜¯å¯¹SpringMVCè§£æå™¨çš„ä¸€æ¬¡å­¦ä¹ æ€»ç»“å§ã€‚</p>
:ET