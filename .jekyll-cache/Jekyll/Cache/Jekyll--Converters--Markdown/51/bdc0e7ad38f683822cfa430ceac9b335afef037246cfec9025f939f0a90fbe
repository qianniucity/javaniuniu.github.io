I"—<p><strong>é»˜è®¤å®ç°SimpleGrantedAuthority</strong></p>
<h4 id="grantedauthorityæ¥å£">GrantedAuthorityæ¥å£</h4>
<p>æˆ‘ä»¬çŸ¥é“UserDeitailsæ¥å£é‡Œé¢æœ‰ä¸€ä¸ªgetAuthorities()æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•å°†è¿”å›æ­¤ç”¨æˆ·çš„æ‰€æ‹¥æœ‰çš„æƒé™ã€‚è¿™ä¸ªé›†åˆå°†ç”¨äºç”¨æˆ·çš„è®¿é—®æ§åˆ¶ï¼Œä¹Ÿå°±æ˜¯Authorizationã€‚</p>

<p>æ‰€è°“æƒé™ï¼Œå°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ä¸€èˆ¬ä¸ä¼šé‡å¤ã€‚</p>

<p>æ‰€è°“æƒé™æ£€æŸ¥ï¼Œå°±æ˜¯æŸ¥çœ‹ç”¨æˆ·æƒé™åˆ—è¡¨ä¸­æ˜¯å¦å«æœ‰åŒ¹é…çš„å­—ç¬¦ä¸²ã€‚</p>

<p>å¤åˆ¶ä»£ç 
package org.springframework.security.core;</p>

<p>import java.io.Serializable;</p>

<p>public interface GrantedAuthority extends Serializable {
    String getAuthority();
}
å¤åˆ¶ä»£ç 
â€œè§’è‰²â€å¦‚ä½•è¡¨ç¤ºï¼Ÿä¸Shiroæœ‰ä½•ä¸åŒï¼Ÿ</p>

<p>åœ¨Securityä¸­ï¼Œè§’è‰²å’Œæƒé™å…±ç”¨GrantedAuthorityæ¥å£ï¼Œå”¯ä¸€çš„ä¸åŒè§’è‰²å°±æ˜¯å¤šäº†ä¸ªå‰ç¼€â€ROLE_â€œï¼Œè€Œä¸”å®ƒæ²¡æœ‰Shiroçš„é‚£ç§ä»å±å…³ç³»ï¼Œå³ä¸€ä¸ªè§’è‰²åŒ…å«å“ªäº›æƒé™ç­‰ç­‰ã€‚åœ¨Securityçœ‹æ¥è§’è‰²å’Œæƒé™æ—¶ä¸€æ ·çš„ï¼Œå®ƒè®¤è¯çš„æ—¶å€™ï¼ŒæŠŠæ‰€æœ‰æƒé™ï¼ˆè§’è‰²ã€æƒé™ï¼‰éƒ½å–å‡ºæ¥ï¼Œè€Œä¸æ˜¯åˆ†å¼€éªŒè¯ã€‚</p>

<p>æ‰€ä»¥ï¼Œåœ¨Securityæä¾›çš„UserDetailsServiceé»˜è®¤å®ç°JdbcDaoImplä¸­ï¼Œè§’è‰²å’Œæƒé™éƒ½å­˜å‚¨åœ¨auhtoritiesè¡¨ä¸­ã€‚è€Œä¸æ˜¯åƒShiroé‚£æ ·ï¼Œè§’è‰²æœ‰ä¸ªrolesè¡¨ï¼Œæƒé™æœ‰ä¸ªpermissionsè¡¨ã€‚ä»¥åŠç›¸å…³çš„ç®¡ç†è¡¨ç­‰ç­‰ã€‚</p>

<p>GrantedAuthorityæ¥å£çš„é»˜è®¤å®ç°SimpleGrantedAuthority</p>

<p>å¤åˆ¶ä»£ç 
package org.springframework.security.core.authority;</p>

<p>import org.springframework.security.core.GrantedAuthority;
import org.springframework.util.Assert;</p>

<p>public final class SimpleGrantedAuthority implements GrantedAuthority {
    private static final long serialVersionUID = 500L;
    private final String role;</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public SimpleGrantedAuthority(String role) {
    Assert.hasText(role, "A granted authority textual representation is required");
    this.role = role;
}

public String getAuthority() {
    return this.role;
}

public boolean equals(Object obj) {
    if (this == obj) {
        return true;
    } else {
        return obj instanceof SimpleGrantedAuthority ? this.role.equals(((SimpleGrantedAuthority)obj).role) : false;
    }
}

public int hashCode() {
    return this.role.hashCode();
}

public String toString() {
    return this.role;
} } å¤åˆ¶ä»£ç  æ³¨æ„ï¼Œåœ¨æ„å»ºSimpleGrantedAuthorityå¯¹è±¡çš„æ—¶å€™ï¼Œå®ƒæ²¡æœ‰æ·»åŠ ä»»ä½•å‰ç¼€ã€‚æ‰€ä»¥è¡¨ç¤º"è§’è‰²"çš„æƒé™ï¼Œåœ¨æ•°æ®åº“ä¸­å°±å¸¦æœ‰"ROLE_"å‰ç¼€äº†ã€‚æ‰€ä»¥authoritiesè¡¨ä¸­çš„è§†å›¾å¯èƒ½æ˜¯è¿™æ ·çš„ã€‚
</code></pre></div></div>

<p><img src="/assets/images/SpringSecurity/1313132-20190119134521755-1100857786.png" alt="å›¾ç‰‡pic1" /></p>

<p>è§’è‰²å’Œæƒé™èƒ½å¦åˆ†å¼€å­˜å‚¨ï¼Ÿè§’è‰²èƒ½ä¸èƒ½ä¸å¸¦â€ROLE_â€œå‰ç¼€</p>

<p>å½“ç„¶å¯ä»¥åˆ†å¼€å­˜å‚¨ï¼Œä½ å¯ä»¥å®šä¹‰ä¸¤å¼ è¡¨ï¼Œä¸€å¼ å­˜è§’è‰²ï¼Œä¸€å¼ å­˜æƒé™ã€‚ä½†æ˜¯ä½ è‡ªå®šä¹‰UserDetailsServiceçš„æ—¶å€™ï¼Œéœ€è¦ä¿è¯æŠŠè¿™ä¸¤å¼ è¡¨çš„æ•°æ®éƒ½å–å‡ºæ¥ï¼Œæ”¾åˆ°UserDailsçš„æƒé™é›†åˆä¸­ã€‚å½“ç„¶ä½ æ•°æ®åº“ä¸­å­˜å‚¨çš„è§’è‰²ä¹Ÿå¯ä»¥ä¸å¸¦â€ROLE_â€œå‰ç¼€ï¼Œå°±åƒè¿™æ ·ã€‚</p>

<p><img src="/assets/images/SpringSecurity/1313132-20190119133239244-1352677896.png" alt="å›¾ç‰‡pic2" />
<img src="/assets/images/SpringSecurity/1313132-20190119133256601-1567591650.png" alt="å›¾ç‰‡pic3" /></p>

<p>ä½†æ˜¯å‰é¢è¯´åˆ°äº†ï¼ŒSecurityæ‰ä¸ç®¡ä½ æ˜¯è§’è‰²ï¼Œè¿˜æ˜¯æƒé™ã€‚å®ƒåªæ¯”å¯¹å­—ç¬¦ä¸²ã€‚</p>

<p>æ¯”å¦‚å®ƒæœ‰ä¸ªè¡¨è¾¾å¼hasRole(â€œADMINâ€)ã€‚é‚£å®ƒå®é™…ä¸ŠæŸ¥è¯¢çš„æ˜¯ç”¨æˆ·æƒé™é›†åˆä¸­æ˜¯å¦å­˜åœ¨å­—ç¬¦ä¸²â€ROLE_ADMINâ€ã€‚å¦‚æœä½ ä»è§’è‰²è¡¨ä¸­å–å‡ºç”¨æˆ·æ‰€æ‹¥æœ‰çš„è§’è‰²æ—¶ä¸åŠ ä¸Šâ€ROLE_â€œå‰ç¼€ï¼Œé‚£éªŒè¯çš„æ—¶å€™å°±åŒ¹é…ä¸ä¸Šäº†ã€‚</p>

<p>æ‰€ä»¥è§’è‰²ä¿¡æ¯å­˜å‚¨çš„æ—¶å€™å¯ä»¥æ²¡æœ‰â€ROLE_â€œå‰ç¼€ï¼Œä½†æ˜¯åŒ…è£…æˆGrantedAuthorityå¯¹è±¡çš„æ—¶å€™å¿…é¡»è¦æœ‰ã€‚</p>

<p>æƒé™æ£€æŸ¥/è®¿é—®æ§åˆ¶æ–¹å¼</p>

<p>æƒé™æ£€æŸ¥æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯åœ¨é…ç½®ç±»ä¸­ï¼ŒæŒ‡å®šç²—ç²’åº¦çš„è®¿é—®æ§åˆ¶ï¼Œå¦ä¸€ç§æ˜¯ä½¿ç”¨æ³¨è§£ç»†ç²’åº¦çš„æ§åˆ¶è®¿é—®ã€‚</p>

<p>ç²—ç²’åº¦è®¿é—®æ§åˆ¶ï¼Œæ‰€æœ‰URLä»¥â€/adminâ€å¼€å¤´çš„ç”¨æˆ·å¿…é¡»æ‹¥æœ‰è§’è‰²â€ADMINâ€æ‰èƒ½è®¿é—®ã€‚å®é™…ä¸Šæ“ä½œçš„æ—¶å€™hasRoleè¡¨è¾¾å¼ï¼Œä¼šåˆ¤æ–­å‚æ•°æ˜¯å¦åŒ…å«â€ROLE_â€œå‰ç¼€ï¼Œå¦‚æœæ²¡æœ‰åˆ™åŠ ä¸Šå»ï¼Œç„¶åå†å»æ ¡éªŒã€‚æœ‰è¿™ä¸ªå‰ç¼€åˆ™ç›´æ¥æ ¡éªŒã€‚</p>

<p>å¤åˆ¶ä»£ç 
protected void configure(HttpSecurity http) throws Exception {
        http.authorizeRequests()
                .antMatchers(â€œ/admin/<strong>â€).access(â€œhasRole(â€˜ADMINâ€™)â€)
                .antMatchers(â€œ/user/</strong>â€).access(â€œhasRole(â€˜USERâ€™)â€)
                .anyRequest().authenticated();</p>

<p>}
å¤åˆ¶ä»£ç 
ç»†ç²’åº¦çš„è®¿é—®æ§åˆ¶</p>

<p>æ³¨ï¼šéœ€è¦ä½¿ç”¨æ³¨è§£@EnableGlobalMethodSecurity(prePostEnabled=true) å¼€å¯</p>

<p>@PreAuthoritze(â€œhasAuthority(â€˜readArticalâ€™)â€)
public List<Artical> getAll() {
    //...
}
è¿™ä¸ªæ³¨è§£ï¼Œä¼šä»SecurityContextä¸­å–å‡ºAuthencationå¯¹è±¡ï¼Œç„¶åå†å–å‡ºCollection<GrantedAuthority> authoritesé›†åˆã€‚ç„¶åæ¯”å¯¹å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰æƒé™"readArtical"ã€‚å®é™…ä¸Šå°±æ˜¯æ¯”å¯¹é›†åˆä¸­æ˜¯å¦æœ‰é‚£ä¸ªGrantedAuthorityçš„getAuthority()æ–¹æ³•è¿”å›çš„å­—ç¬¦ä¸²ä¸"radArtical"åŒ¹é…ã€‚</GrantedAuthority></Artical></p>
:ET