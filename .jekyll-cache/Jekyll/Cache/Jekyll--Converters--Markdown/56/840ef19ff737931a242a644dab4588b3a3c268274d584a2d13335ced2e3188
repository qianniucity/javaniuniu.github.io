I"Îl<h5 id="ä¸€å¥è¯ç®€ä»‹">ä¸€å¥è¯ç®€ä»‹</h5>
<p>WebMvcConfigureré…ç½®ç±»å…¶å®æ˜¯Springå†…éƒ¨çš„ä¸€ç§é…ç½®æ–¹å¼ï¼Œé‡‡ç”¨JavaBeançš„å½¢å¼æ¥ä»£æ›¿ä¼ ç»Ÿçš„xmlé…ç½®æ–‡ä»¶å½¢å¼è¿›è¡Œé’ˆå¯¹æ¡†æ¶ä¸ªæ€§åŒ–å®šåˆ¶ï¼Œå¯ä»¥è‡ªå®šä¹‰ä¸€äº›Handlerï¼ŒInterceptorï¼ŒViewResolverï¼ŒMessageConverterã€‚åŸºäºjava-basedæ–¹å¼çš„spring mvcé…ç½®ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªé…ç½®ç±»å¹¶å®ç°WebMvcConfigurer æ¥å£</p>

<h5 id="ä¸»è¦è®²è§£">ä¸»è¦è®²è§£</h5>
<p>é€šè¿‡ViewControllerå°†ä¸€ä¸ªè¯·æ±‚è½¬åˆ°ä¸€ä¸ªé¡µé¢
é€šè¿‡ResourceHandlerså®ç°é™æ€èµ„æºçš„åœ°å€æ˜ å°„
é€šè¿‡MessageConverterå®ç°å°†@ResponseBodyå®ä½“è½¬Fastjsonå­—ç¬¦ä¸²è¿”å›ï¼Œå¯ä»¥è¿”å›å®ä½“è¿›è¡Œé‡å†™
é€šè¿‡addCorsMappingså®ç°ajaxè·¨åŸŸè¯·æ±‚
é€šè¿‡addInterceptorsæ·»åŠ æ‹¦æˆªå™¨</p>

<p>SpringBoot2.0ï¼ˆå®˜æ–¹æ¨èï¼‰</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>    
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebMvcConfg</span> <span class="kd">implements</span> <span class="nc">WebMvcConfigurer</span> <span class="o">{</span>
<span class="o">}</span>
</code></pre></div></div>

<p>SpringBoot2.0ä»¥å‰ç‰ˆæœ¬</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>    
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebMvcConfig</span> <span class="kd">extends</span> <span class="nc">WebMvcConfigurerAdapter</span> <span class="o">{</span>
<span class="err">ï½</span>
</code></pre></div></div>
<h5 id="é…ç½®resourcehandlers">é…ç½®ResourceHandlers</h5>
<p>æ­¤æ–¹æ³•ç”¨æ¥ä¸“é—¨æ³¨å†Œä¸€ä¸ªHandlerï¼Œæ¥å¤„ç†é™æ€èµ„æºçš„ï¼Œä¾‹å¦‚ï¼šå›¾ç‰‡ï¼Œjsï¼Œcssç­‰ã€‚ä¸¾ä¾‹ï¼š</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nd">@Override</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addResourceHandlers</span><span class="o">(</span><span class="nc">ResourceHandlerRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
     <span class="c1">//å¯ä»¥é€šè¿‡http://127.0.0.1:8080/web/home.htmlè®¿é—®resources/web/home.htmlé¡µé¢</span>
     <span class="n">registry</span><span class="o">.</span><span class="na">addResourceHandler</span><span class="o">(</span><span class="s">"/web/**"</span><span class="o">).</span><span class="na">addResourceLocations</span><span class="o">(</span><span class="s">"classpath:/web/"</span><span class="o">);</span>
 <span class="o">}</span>
</code></pre></div></div>
<p>å½“ä½ è¯·æ±‚http://127.0.0.1:8080/web/home.htmlæ—¶ï¼Œä¼šæŠŠresources/web/home.htmlè¿”å›ã€‚æ³¨æ„ï¼šè¿™é‡Œçš„é™æ€èµ„æºæ˜¯æ”¾ç½®åœ¨WEB-INFç›®å½•ä¸‹çš„</p>

<h5 id="é…ç½®viewcontroller">é…ç½®ViewController</h5>
<p>æ­¤æ–¹æ³•å¯ä»¥å¾ˆæ–¹ä¾¿çš„å®ç°ä¸€ä¸ªè¯·æ±‚åˆ°è§†å›¾çš„æ˜ å°„ï¼Œè€Œæ— éœ€ä¹¦å†™controllerï¼Œä¾‹å¦‚ï¼š</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addViewControllers</span><span class="o">(</span><span class="nc">ViewControllerRegistry</span> <span class="n">registry</span><span class="o">){</span>
	<span class="n">registry</span><span class="o">.</span><span class="na">addViewController</span><span class="o">(</span><span class="s">"/login"</span><span class="o">).</span><span class="na">setViewName</span><span class="o">(</span><span class="s">"web/login.html"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>
<p>|è¿™æ˜¯è®¿é—®http://127.0.0.1:8080/loginæ—¶ï¼Œä¼šç›´æ¥è¿”å›login.htmlé¡µé¢ã€‚</p>

<h5 id="é…ç½®messageconverter">é…ç½®MessageConverter</h5>
<p>è¿™ä¸ªé…ç½®ä¸€èˆ¬é’ˆå¯¹äºApiæ¥å£æœåŠ¡ç¨‹åºï¼Œé…ç½®åœ¨è¯·æ±‚è¿”å›æ—¶å†…å®¹é‡‡ç”¨ä»€ä¹ˆè½¬æ¢å™¨è¿›è¡Œè½¬æ¢ï¼Œæˆ‘ä»¬æœ€å¸¸ç”¨åˆ°çš„å°±æ˜¯fastJsonçš„è½¬æ¢ï¼Œé…ç½®å¦‚ä¸‹æ‰€ç¤º</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="cm">/**
     * æ¶ˆæ¯å†…å®¹è½¬æ¢é…ç½®
     * é…ç½®fastJsonè¿”å›jsonè½¬æ¢
     * @param converters
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configureMessageConverters</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">HttpMessageConverter</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">converters</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//åˆ›å»ºfastJsonæ¶ˆæ¯è½¬æ¢å™¨</span>
        <span class="nc">FastJsonHttpMessageConverter</span> <span class="n">fastConverter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FastJsonHttpMessageConverter</span><span class="o">(){</span>
            <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">writeInternal</span><span class="o">(</span><span class="nc">Object</span> <span class="n">obj</span><span class="o">,</span> <span class="nc">HttpOutputMessage</span> <span class="n">outputMessage</span><span class="o">){</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="k">if</span><span class="o">(</span><span class="n">obj</span> <span class="k">instanceof</span> <span class="nc">PreUser</span><span class="o">){</span>
                        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
                        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"preUser"</span><span class="o">,</span><span class="n">obj</span><span class="o">);</span>
                        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"result"</span><span class="o">,</span><span class="s">"success"</span><span class="o">);</span>
                        <span class="kd">super</span><span class="o">.</span><span class="na">writeInternal</span><span class="o">(</span> <span class="n">map</span><span class="o">,</span> <span class="n">outputMessage</span><span class="o">);</span>
                    <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                        <span class="kd">super</span><span class="o">.</span><span class="na">writeInternal</span><span class="o">(</span> <span class="n">obj</span><span class="o">,</span> <span class="n">outputMessage</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">};</span>
      <span class="c1">//  FastJsonHttpMessageConverter fastConverter = new FastJsonHttpMessageConverter();</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">MediaType</span><span class="o">&gt;</span> <span class="n">supportedMediaTypes</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="n">supportedMediaTypes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">);</span>
        <span class="n">supportedMediaTypes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON_UTF8</span><span class="o">);</span>
        <span class="n">fastConverter</span><span class="o">.</span><span class="na">setSupportedMediaTypes</span><span class="o">(</span><span class="n">supportedMediaTypes</span><span class="o">);</span>

        <span class="c1">//åˆ›å»ºé…ç½®ç±»</span>
        <span class="nc">FastJsonConfig</span> <span class="n">fastJsonConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FastJsonConfig</span><span class="o">();</span>
        <span class="n">fastJsonConfig</span><span class="o">.</span><span class="na">setCharset</span><span class="o">(</span><span class="nc">Charset</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"UTF-8"</span><span class="o">));</span>
        <span class="n">fastJsonConfig</span><span class="o">.</span><span class="na">setDateFormat</span><span class="o">(</span><span class="s">"YYYY-MM-dd"</span><span class="o">);</span>

        <span class="c1">//ä¿®æ”¹é…ç½®è¿”å›å†…å®¹çš„è¿‡æ»¤</span>
        <span class="n">fastJsonConfig</span><span class="o">.</span><span class="na">setSerializerFeatures</span><span class="o">(</span>
                <span class="nc">SerializerFeature</span><span class="o">.</span><span class="na">DisableCircularReferenceDetect</span><span class="o">,</span>
                <span class="nc">SerializerFeature</span><span class="o">.</span><span class="na">WriteMapNullValue</span><span class="o">,</span>
                <span class="nc">SerializerFeature</span><span class="o">.</span><span class="na">WriteNullStringAsEmpty</span><span class="o">,</span>
                <span class="nc">SerializerFeature</span><span class="o">.</span><span class="na">PrettyFormat</span>
        <span class="o">);</span>
        <span class="n">fastConverter</span><span class="o">.</span><span class="na">setFastJsonConfig</span><span class="o">(</span><span class="n">fastJsonConfig</span><span class="o">);</span>
        <span class="c1">//å°†fastjsonæ·»åŠ åˆ°è§†å›¾æ¶ˆæ¯è½¬æ¢å™¨åˆ—è¡¨å†…</span>
        <span class="n">converters</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">fastConverter</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre></div></div>

<table>
  <tbody>
    <tr>
      <td>FastJson SerializerFeatures</td>
    </tr>
    <tr>
      <td>WriteNullListAsEmpty ï¼šListå­—æ®µå¦‚æœä¸ºnull,è¾“å‡ºä¸º[],è€Œénull</td>
    </tr>
    <tr>
      <td>WriteNullStringAsEmpty ï¼š å­—ç¬¦ç±»å‹å­—æ®µå¦‚æœä¸ºnull,è¾“å‡ºä¸ºâ€â€œ,è€Œénull</td>
    </tr>
    <tr>
      <td>DisableCircularReferenceDetect ï¼šæ¶ˆé™¤å¯¹åŒä¸€å¯¹è±¡å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œé»˜è®¤ä¸ºfalseï¼ˆå¦‚æœä¸é…ç½®æœ‰å¯èƒ½ä¼šè¿›å…¥æ­»å¾ªç¯ï¼‰</td>
    </tr>
    <tr>
      <td>WriteNullBooleanAsFalseï¼šBooleanå­—æ®µå¦‚æœä¸ºnull,è¾“å‡ºä¸ºfalse,è€Œénull</td>
    </tr>
    <tr>
      <td>WriteMapNullValueï¼šæ˜¯å¦è¾“å‡ºå€¼ä¸ºnullçš„å­—æ®µ,é»˜è®¤ä¸ºfalseã€‚</td>
    </tr>
    <tr>
      <td>WriteNullNumberAsZero: æ•°å€¼å­—æ®µå¦‚æœä¸ºnullï¼Œåˆ™è¾“å‡ºä¸º0</td>
    </tr>
  </tbody>
</table>

<table>
  <tbody>
    <tr>
      <td>é‡å†™writeInternalæ–¹æ³•ï¼Œå¯ä»¥é‡æ–°æ„é€ è¿”å›å¯¹è±¡ï¼Œè¾¾åˆ°ç»Ÿä¸€çš„è¿”å›å€¼</td>
    </tr>
    <tr>
      <td>setDateFormat(â€œYYYY-MM-ddâ€);è®¾ç½®æ—¥æœŸç±»å‹çš„è¿”å›æ ¼å¼</td>
    </tr>
  </tbody>
</table>

<p>httpmessageconvertåœ¨è‡ªåŠ¨é…ç½®jacksonï¼Œé»˜è®¤ä½¿ç”¨ç”¨jackson ã€‚æ‰€ä»¥å¦‚æœè¿”å›ç±»å‹ä¸ºapplication/jsonçš„æ•°æ®ä½¿ç”¨jackson ã€‚æ‰€ä»¥å»é™¤jacksonçš„ä¾èµ–ã€‚</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       <span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;exclusions&gt;</span>
				<span class="nt">&lt;exclusion&gt;</span>
					<span class="nt">&lt;artifactId&gt;</span>jackson-databind<span class="nt">&lt;/artifactId&gt;</span>
					<span class="nt">&lt;groupId&gt;</span>com.fasterxml.jackson.core<span class="nt">&lt;/groupId&gt;</span>
				<span class="nt">&lt;/exclusion&gt;</span>
			<span class="nt">&lt;/exclusions&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>ä¸å»ä¾èµ–çš„å†™æ³•</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nd">@Configuration</span>
    <span class="nd">@ConditionalOnClass</span><span class="o">({</span><span class="nc">FastJsonHttpMessageConverter</span><span class="o">.</span><span class="na">class</span><span class="o">})</span> <span class="c1">//1</span>
    <span class="nd">@ConditionalOnProperty</span><span class="o">(</span><span class="c1">//2</span>
            <span class="n">name</span> <span class="o">=</span> <span class="o">{</span><span class="s">"spring.http.converters.preferred-json-mapper"</span><span class="o">},</span>
            <span class="n">havingValue</span> <span class="o">=</span> <span class="s">"fastjson"</span><span class="o">,</span>
            <span class="n">matchIfMissing</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="o">)</span>
    <span class="kd">protected</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">FastJson2HttpMessageConverterConfiguration</span> <span class="o">{</span>
        <span class="kd">protected</span> <span class="nf">FastJson2HttpMessageConverterConfiguration</span><span class="o">()</span> <span class="o">{</span>
        <span class="o">}</span>
        <span class="nd">@Bean</span>
        <span class="nd">@ConditionalOnMissingBean</span><span class="o">({</span><span class="nc">FastJsonHttpMessageConverter</span><span class="o">.</span><span class="na">class</span><span class="o">})</span><span class="c1">//3</span>
        <span class="kd">public</span> <span class="nc">FastJsonHttpMessageConverter</span> <span class="nf">fastJsonHttpMessageConverter</span><span class="o">()</span> <span class="o">{</span>
            <span class="c1">//åˆ›å»ºfastJsonæ¶ˆæ¯è½¬æ¢å™¨</span>
            <span class="nc">FastJsonHttpMessageConverter</span> <span class="n">fastConverter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FastJsonHttpMessageConverter</span><span class="o">(){</span>
                <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">writeInternal</span><span class="o">(</span><span class="nc">Object</span> <span class="n">obj</span><span class="o">,</span> <span class="nc">HttpOutputMessage</span> <span class="n">outputMessage</span><span class="o">){</span>
                    <span class="k">try</span> <span class="o">{</span>
                        <span class="k">if</span><span class="o">(</span><span class="n">obj</span> <span class="k">instanceof</span> <span class="nc">PreUser</span><span class="o">){</span>
                            <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
                            <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"result"</span><span class="o">,</span><span class="s">"success"</span><span class="o">);</span>
                            <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"preUser"</span><span class="o">,</span><span class="n">obj</span><span class="o">);</span>
                            <span class="kd">super</span><span class="o">.</span><span class="na">writeInternal</span><span class="o">(</span> <span class="n">map</span><span class="o">,</span> <span class="n">outputMessage</span><span class="o">);</span>
                        <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                            <span class="kd">super</span><span class="o">.</span><span class="na">writeInternal</span><span class="o">(</span> <span class="n">obj</span><span class="o">,</span> <span class="n">outputMessage</span><span class="o">);</span>
                        <span class="o">}</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">};</span>
            <span class="c1">//  FastJsonHttpMessageConverter fastConverter = new FastJsonHttpMessageConverter();</span>
            <span class="nc">List</span><span class="o">&lt;</span><span class="nc">MediaType</span><span class="o">&gt;</span> <span class="n">supportedMediaTypes</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
            <span class="n">supportedMediaTypes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">);</span>
            <span class="n">supportedMediaTypes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON_UTF8</span><span class="o">);</span>
            <span class="n">fastConverter</span><span class="o">.</span><span class="na">setSupportedMediaTypes</span><span class="o">(</span><span class="n">supportedMediaTypes</span><span class="o">);</span>

            <span class="c1">//åˆ›å»ºé…ç½®ç±»</span>
            <span class="nc">FastJsonConfig</span> <span class="n">fastJsonConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FastJsonConfig</span><span class="o">();</span>
            <span class="n">fastJsonConfig</span><span class="o">.</span><span class="na">setCharset</span><span class="o">(</span><span class="nc">Charset</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"UTF-8"</span><span class="o">));</span>
            <span class="n">fastJsonConfig</span><span class="o">.</span><span class="na">setDateFormat</span><span class="o">(</span><span class="s">"YYYY-MM-dd"</span><span class="o">);</span>

            <span class="c1">//ä¿®æ”¹é…ç½®è¿”å›å†…å®¹çš„è¿‡æ»¤</span>
            <span class="n">fastJsonConfig</span><span class="o">.</span><span class="na">setSerializerFeatures</span><span class="o">(</span>
                    <span class="nc">SerializerFeature</span><span class="o">.</span><span class="na">DisableCircularReferenceDetect</span><span class="o">,</span>
                    <span class="nc">SerializerFeature</span><span class="o">.</span><span class="na">WriteMapNullValue</span><span class="o">,</span>
                    <span class="nc">SerializerFeature</span><span class="o">.</span><span class="na">WriteNullStringAsEmpty</span><span class="o">,</span>
                    <span class="nc">SerializerFeature</span><span class="o">.</span><span class="na">PrettyFormat</span>
            <span class="o">);</span>
            <span class="n">fastConverter</span><span class="o">.</span><span class="na">setFastJsonConfig</span><span class="o">(</span><span class="n">fastJsonConfig</span><span class="o">);</span>
            <span class="c1">//å°†fastjsonæ·»åŠ åˆ°è§†å›¾æ¶ˆæ¯è½¬æ¢å™¨åˆ—è¡¨å†…</span>
           <span class="c1">// converters.add(fastConverter);</span>
            <span class="k">return</span> <span class="n">fastConverter</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div></div>

<p>application.ymlæ·»åŠ é…ç½®</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>spring:
  http:
    converters:
      preferred-json-mapper: fastjson
</code></pre></div></div>

<p>ä»¥ä¸Šä»£ç åˆ¤æ–­è¿”å›ç±»å‹PreUserçš„å¯¹è±¡ï¼Œè¿›è¡Œé‡å†™ã€‚è¿”å›æ•°æ®ä¸º</p>
<pre><code class="language-FastJson">{
	"result":"success",
	"preUser":{
		"address":"å¹¿ä¸œå¹¿å·å¤©æ²³",
		"age":29,
		"date":"2018-09-20",
		"desc":"tom is 29 years old",
		"hobby":[
			"æ‰“çƒ",
			"å†™ä»£ç "
		],
		"name":"tom",
		"phone":""
	}
}
</code></pre>

<h5 id="é…ç½®corsè·¨åŸŸ">é…ç½®CORSè·¨åŸŸ</h5>

<p>Springæ—¢ç„¶ä¸ºäº†é›†æˆäº†CROSï¼Œé‚£å°±è¯æ˜äº†ä¸€ç‚¹ï¼Œä»¥åå‰åç«¯åˆ†ç¦»æ˜¯ä¸€ä¸ªå¼€å‘è¶‹åŠ¿</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
   <span class="cm">/**
     * è·¨åŸŸCORSé…ç½®
     * @param registry
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addCorsMappings</span><span class="o">(</span><span class="nc">CorsRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">addCorsMappings</span><span class="o">(</span><span class="n">registry</span><span class="o">);</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">addMapping</span><span class="o">(</span><span class="s">"/cors/**"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">allowedHeaders</span><span class="o">(</span><span class="s">"*"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">allowedMethods</span><span class="o">(</span><span class="s">"POST"</span><span class="o">,</span><span class="s">"GET"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">allowedOrigins</span><span class="o">(</span><span class="s">"*"</span><span class="o">);</span>
    <span class="o">}</span>  
</code></pre></div></div>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
	<span class="nt">&lt;head&gt;</span>
		<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;title&gt;&lt;/title&gt;</span>
		<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"js/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
		<span class="nt">&lt;script&gt;</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
                <span class="na">type</span><span class="p">:</span><span class="dl">"</span><span class="s2">GET</span><span class="dl">"</span><span class="p">,</span>
                <span class="na">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">http://localhost:8080/preUser</span><span class="dl">"</span><span class="p">,</span>
                <span class="na">dataType</span><span class="p">:</span><span class="dl">"</span><span class="s2">json</span><span class="dl">"</span><span class="p">,</span>
                <span class="na">success</span><span class="p">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">xhr</span><span class="p">){</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">getAllResponseHeaders</span><span class="p">());</span>
                <span class="p">},</span>
                <span class="na">error</span><span class="p">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">jqXHR</span><span class="p">){</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Error: </span><span class="dl">"</span><span class="o">+</span><span class="nx">jqXHR</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">});</span>
		<span class="nt">&lt;/script&gt;</span>
	<span class="nt">&lt;/head&gt;</span>
	<span class="nt">&lt;body&gt;</span>
		cores.html
	<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>éªŒè¯è®¿é—®ï¼šhttp://127.0.0.1:8080/web/cors.html,æ²¡è®¾ç½®addCorsMappings()æŠ¥è·¨åŸŸå¼‚å¸¸ã€‚</p>

<h5 id="é…ç½®æ‹¦æˆªå™¨">é…ç½®æ‹¦æˆªå™¨</h5>
<p>åœ¨ä¹‹å‰Xmlé…ç½®å½¢å¼å¤©ä¸‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½æ˜¯åœ¨spring-mvc.xmlé…ç½®æ–‡ä»¶å†…æ·»åŠ <mvc:interceptor>æ ‡ç­¾é…ç½®æ‹¦æˆªå™¨ã€‚</mvc:interceptor></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/**
 * æ‹¦æˆªå™¨é…ç½®
 * @param registry
 */
@Override
public void addInterceptors(InterceptorRegistry registry) {
    registry.addInterceptor(new CustomHandlerInterceptor()).addPathPatterns("/**");
} 1 2 3 4 5 6 7 8 InterceptorRegistryå†…çš„addInterceptoréœ€è¦ä¸€ä¸ªå®ç°HandlerInterceptoræ¥å£çš„æ‹¦æˆªå™¨å®ä¾‹ï¼ŒaddPathPatternsæ–¹æ³•ç”¨äºè®¾ç½®æ‹¦æˆªå™¨çš„è¿‡æ»¤è·¯å¾„è§„åˆ™Â·ã€‚excludePathPatterns è¡¨ç¤ºä¸æ‹¦æˆªã€‚
</code></pre></div></div>

<p>@Slf4j
public class CustomHandlerInterceptor implements HandlerInterceptor {
    @Override
    public boolean preHandle(HttpServletRequest request,
                             HttpServletResponse response, Object handler)
            throws Exception {
        log.info(â€œpreHandle:è¯·æ±‚å‰è°ƒç”¨â€);
        //è¿”å› false åˆ™è¯·æ±‚ä¸­æ–­
        return true;
    }</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Override
public void postHandle(HttpServletRequest request,
                       HttpServletResponse response, Object handler,
                       ModelAndView modelAndView) throws Exception {
    log.info("postHandle:è¯·æ±‚åè°ƒç”¨");
}

@Override
public void afterCompletion(HttpServletRequest request,
                            HttpServletResponse response, Object handler, Exception ex)
        throws Exception {
    log.info("afterCompletion:è¯·æ±‚è°ƒç”¨å®Œæˆåå›è°ƒæ–¹æ³•ï¼Œå³åœ¨è§†å›¾æ¸²æŸ“å®Œæˆåå›è°ƒ");
} }
</code></pre></div></div>

<p>æ¯æ¬¡è¯·æ±‚æ—¶æ‰“å°</p>

<p>2018-12-24 22:21:34.434  INFO 2156 â€” [io-8080-exec-10]  : preHandle:è¯·æ±‚å‰è°ƒç”¨
2018-12-24 22:21:34.436  INFO 2156 â€” [io-8080-exec-10]  : postHandle:è¯·æ±‚åè°ƒç”¨
2018-12-24 22:21:34.436  INFO 2156 â€” [io-8080-exec-10]  : afterCompletion:è¯·æ±‚è°ƒç”¨å®Œæˆåå›è°ƒæ–¹æ³•ï¼Œå³åœ¨è§†å›¾æ¸²æŸ“å®Œæˆåå›è°ƒ</p>
:ET