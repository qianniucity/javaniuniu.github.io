I"Á<h2 id="ç®€ä»‹">ç®€ä»‹</h2>
<p>è‡ªå®šä¹‰è§£æå™¨éœ€è¦å®ç° <em>HandlerMethodArgumentResolver</em> æ¥å£ï¼Œ <em>HandlerMethodArgumentResolver</em> æ¥å£åŒ…å«ä¸¤ä¸ªæ¥å£å‡½æ•°ï¼š</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">HandlerMethodArgumentResolver</span> <span class="o">{</span>
    <span class="kt">boolean</span> <span class="nf">supportsParameter</span><span class="o">(</span><span class="nc">MethodParameter</span> <span class="n">var1</span><span class="o">);</span>

    <span class="nd">@Nullable</span>
    <span class="nc">Object</span> <span class="nf">resolveArgument</span><span class="o">(</span><span class="nc">MethodParameter</span> <span class="n">var1</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="nc">ModelAndViewContainer</span> <span class="n">var2</span><span class="o">,</span> <span class="nc">NativeWebRequest</span> <span class="n">var3</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="nc">WebDataBinderFactory</span> <span class="n">var4</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="è‡ªå®šä¹‰ä¸€ä¸ªè§£æå™¨currentusermethodargumentresolver">è‡ªå®šä¹‰ä¸€ä¸ªè§£æå™¨CurrentUserMethodArgumentResolver</h2>

<p>æˆ‘ä»¬åœ¨è§£æå™¨ä¸­è¿”å›ä¸€ä¸ªå›ºå®šçš„UserBeannew UserBean(1L,â€adminâ€)ï¼Œå®é™…æƒ…å†µæ˜¯ä»Sessionã€æ•°æ®åº“æˆ–è€…ç¼“å­˜ä¸­æŸ¥ã€‚</p>

<p>import org.springframework.core.MethodParameter;
import org.springframework.web.bind.support.WebDataBinderFactory;
import org.springframework.web.context.request.NativeWebRequest;
import org.springframework.web.method.support.HandlerMethodArgumentResolver;
import org.springframework.web.method.support.ModelAndViewContainer;</p>

<p>/**</p>
<ul>
  <li>ç”¨äºç»‘å®š@CurrentUserçš„æ–¹æ³•å‚æ•°è§£æå™¨
 *</li>
  <li>
    <p>@author lism
 */
public class CurrentUserMethodArgumentResolver implements HandlerMethodArgumentResolver {</p>

    <p>public CurrentUserMethodArgumentResolver() {
 }</p>

    <p>@Override
 public boolean supportsParameter(MethodParameter parameter) {
     if (parameter.getParameterType().isAssignableFrom(UserBean.class) &amp;&amp; parameter.hasParameterAnnotation(CurrentUser.class)) {
         return true;
     }
     return false;
 }</p>

    <p>@Override
 public Object resolveArgument(MethodParameter parameter, ModelAndViewContainer mavContainer, NativeWebRequest webRequest, WebDataBinderFactory binderFactory) throws Exception {
     CurrentUser currentUserAnnotation = parameter.getParameterAnnotation(CurrentUser.class);
     //ä»Session è·å–ç”¨æˆ·
     Object object = webRequest.getAttribute(currentUserAnnotation.value(), NativeWebRequest.SCOPE_SESSION);
//ä»  accessTokenè·å¾—ç”¨æˆ·ä¿¡æ¯
    if (object == null) {
         String token = webRequest.getHeader(â€œAuthorizationâ€);
         if (token == null) {
             token = webRequest.getParameter(â€œaccessTokenâ€);
         }
         //ä¸ºäº†æµ‹è¯•å…ˆå†™æ­»ç”¨æˆ·å
         //TODO: å–çœŸå®ç”¨æˆ·
         return new UserBean(1L,â€adminâ€);
     }
     return object;
 }
}</p>
  </li>
</ul>

<p>è‡ªå®šä¹‰æ³¨è§£@CurrentUser</p>

<p>import java.lang.annotation.*;</p>

<p>/**</p>
<ul>
  <li>
    <p>ç»‘å®šå½“å‰ç™»å½•çš„ç”¨æˆ·</p>
  </li>
  <li>
    <p>ä¸åŒäº@ModelAttribute</p>
    <p>*</p>
  </li>
  <li>
    <p>@author lism
 */
@Target({ElementType.PARAMETER})
@Retention(RetentionPolicy.RUNTIME)
@Documented
public @interface CurrentUser {</p>

    <p>/**</p>
    <ul>
      <li>å½“å‰ç”¨æˆ·åœ¨requestä¸­çš„åå­—
  *</li>
      <li>@return
  */
 String value() default â€œuserâ€;</li>
    </ul>
  </li>
</ul>

<p>}
åœ¨æ§åˆ¶å™¨ä¸­ä½¿ç”¨@CurrentUser</p>

<p>åœ¨æ§åˆ¶å™¨æ–¹æ³•ä¸ŠåŠ å…¥@CurrentUser UserBean userBeanå³å¯è‡ªåŠ¨æ³¨å…¥userBeançš„å€¼</p>

<p>@RestController
@RequestMapping(value = â€œ/testâ€)
public class TestController  {</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/**
 * æ ¹æ®nameæŸ¥è¯¢
 *
 * @param request
 * @return
 */
@RequestMapping(value = "/testCurrentUser", method = RequestMethod.POST, produces = "application/json", consumes = "application/json")
@ResponseBody
public void test(@CurrentUser UserBean userBean, @RequestBody SubjectRequest request) {
    String createdBy = userBean.getUsername();
    log.info(createdBy);
} } Userå®ä½“UserBean
</code></pre></div></div>

<p>import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;</p>

<p>import java.io.Serializable;</p>

<p>@Data
@NoArgsConstructor
@AllArgsConstructor
public class UserBean implements Serializable {
    private Long id;
    private String username;
}
æ€»ç»“</p>

<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ç°HandlerMethodArgumentResolveræ¥å£æ¥å®ç°å¯¹è‡ªå®šä¹‰çš„å‚æ•°è¿›è¡Œè§£æã€‚
æ¯”å¦‚å¯ä»¥è§£æè‡ªå®šä¹‰çš„æ—¶é—´æ ¼å¼ã€è‡ªå®šä¹‰è§£æMapå¯¹è±¡ç­‰è¿™äº›springåŸæœ¬ä¸æ”¯æŒçš„å¯¹è±¡æ ¼å¼ã€‚</p>

<p>ä½œè€…ï¼šLIæœ¨æ°´
é“¾æ¥ï¼šhttps://www.jianshu.com/p/40606baf49b8
æ¥æºï¼šç®€ä¹¦
è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
:ET