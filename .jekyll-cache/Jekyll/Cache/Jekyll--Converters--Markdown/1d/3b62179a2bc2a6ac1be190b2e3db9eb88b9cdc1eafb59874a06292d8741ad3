I"…’<h2 id="builder">@Builder</h2>
<p>###1. @Builder å®æˆ˜ä½¿ç”¨</p>

<blockquote>
  <blockquote>
    <p>å¦‚æœå¯¹å»ºé€ è€…è®¾è®¡æ¨¡å¼ä¸å¤ªæ¸…æ¥šçš„ï¼Œå¯ä»¥å…ˆäº†è§£ä¸€ä¸‹ï¼šå»ºé€ è¿™æ¨¡å¼</p>
  </blockquote>
</blockquote>

<p>@Builderæ³¨é‡Šä¸ºä½ çš„ç±»ç”Ÿæˆç›¸å¯¹ç•¥å¾®å¤æ‚çš„æ„å»ºå™¨APIã€‚@Builderå¯ä»¥è®©ä½ ä»¥ä¸‹é¢æ˜¾ç¤ºçš„é‚£æ ·è°ƒç”¨ä½ çš„ä»£ç ï¼Œæ¥åˆå§‹åŒ–ä½ çš„å®ä¾‹å¯¹è±¡ï¼š</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Person</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
    <span class="o">.</span><span class="na">name</span><span class="o">(</span><span class="s">"Adam Savage"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">city</span><span class="o">(</span><span class="s">"San Francisco"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">job</span><span class="o">(</span><span class="s">"Mythbusters"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">job</span><span class="o">(</span><span class="s">"Unchained Reaction"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</code></pre></div></div>

<p>@Builderå¯ä»¥æ”¾åœ¨ç±»ï¼Œæ„é€ å‡½æ•°æˆ–æ–¹æ³•ä¸Šã€‚ è™½ç„¶æ”¾åœ¨ç±»ä¸Šå’Œæ”¾åœ¨æ„é€ å‡½æ•°ä¸Šè¿™ä¸¤ç§æ¨¡å¼æ˜¯æœ€å¸¸è§çš„ç”¨ä¾‹ï¼Œä½†@Builderæœ€å®¹æ˜“ç”¨æ”¾åœ¨æ–¹æ³•çš„ç”¨ä¾‹æ¥è§£é‡Šã€‚</p>

<p>ä½¿ç”¨@Builderæ³¨é‡Šçš„æ–¹æ³•å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®Œæˆä¸€ä¸‹ä¸€äº›äº‹æƒ…ï¼š</p>

<ul>
  <li>ä¸€ä¸ªåä¸ºFooBuilderçš„å†…éƒ¨é™æ€ç±»ï¼Œå¹¶å…·æœ‰å’Œå®ä½“ç±»å½¢åŒçš„å±æ€§ï¼ˆç§°ä¸ºæ„å»ºå™¨ï¼‰ã€‚</li>
  <li>åœ¨æ„å»ºå™¨ä¸­ï¼šå¯¹äºç›®æ ‡ç±»ä¸­çš„æ‰€æœ‰çš„å±æ€§å’Œæœªåˆå§‹åŒ–çš„finalå­—æ®µï¼Œéƒ½ä¼šåœ¨æ„å»ºå™¨ä¸­åˆ›å»ºå¯¹åº”å±æ€§ï¼›</li>
  <li>åœ¨æ„å»ºå™¨ä¸­ï¼šåˆ›å»ºä¸€ä¸ªæ— å‚çš„defaultæ„é€ å‡½æ•°ã€‚</li>
  <li>åœ¨æ„å»ºå™¨ä¸­ï¼šå¯¹äºå®ä½“ç±»ä¸­çš„æ¯ä¸ªå‚æ•°ï¼Œéƒ½ä¼šå¯¹åº”åˆ›å»ºç±»ä¼¼äºâ€œsetterâ€çš„æ–¹æ³•ï¼Œåªä¸å¤šæ–¹æ³•åä¸è¯¥å‚æ•°åç›¸åŒã€‚ å¹¶ä¸”è¿”å›å€¼æ˜¯æ„å»ºå™¨æœ¬èº«ï¼ˆä¾¿äºé“¾å¼è°ƒç”¨ï¼‰ï¼Œå¦‚ä¸Šä¾‹æ‰€ç¤ºã€‚</li>
  <li>åœ¨æ„å»ºå™¨ä¸­ï¼šä¸€ä¸ªbuild()æ–¹æ³•ï¼Œè°ƒç”¨æ­¤æ–¹æ³•ï¼Œå°±ä¼šæ ¹æ®è®¾ç½®çš„å€¼è¿›è¡Œåˆ›å»ºå®ä½“å¯¹è±¡ã€‚</li>
  <li>åœ¨æ„å»ºå™¨ä¸­ï¼šåŒæ—¶ä¹Ÿä¼šç”Ÿæˆä¸€ä¸ªtoString()æ–¹æ³•ã€‚</li>
  <li>åœ¨å®ä½“ç±»ä¸­ï¼šä¼šåˆ›å»ºä¸€ä¸ªbuilder()æ–¹æ³•ï¼Œå®ƒçš„ç›®çš„æ˜¯ç”¨æ¥åˆ›å»ºæ„å»ºå™¨ã€‚</li>
</ul>

<blockquote>
  <blockquote>
    <p>è¯´çš„å¤šäº†æœ‰ç‚¹ç»•ï¼Œæˆ‘ä»¬è¿˜æ˜¯å…ˆæ¥ä½¿ç”¨ä¸€ä¸‹è¯•è¯•ï¼Œç„¶åå†è¯¦ç»†è¯´æ˜ï¼š</p>
  </blockquote>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Builder</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">username</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">password</span><span class="o">;</span>
<span class="o">}</span>

<span class="c1">// ç¼–è¯‘åï¼š</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">username</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">password</span><span class="o">;</span>
    <span class="nc">User</span><span class="o">(</span><span class="nc">String</span> <span class="n">username</span><span class="o">,</span> <span class="nc">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">username</span><span class="o">;</span> <span class="k">this</span><span class="o">.</span><span class="na">password</span> <span class="o">=</span> <span class="n">password</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">User</span><span class="o">.</span><span class="na">UserBuilder</span> <span class="nf">builder</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nc">User</span><span class="o">.</span><span class="na">UserBuilder</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">UserBuilder</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="nc">String</span> <span class="n">username</span><span class="o">;</span>
        <span class="kd">private</span> <span class="nc">String</span> <span class="n">password</span><span class="o">;</span>
        <span class="nc">UserBuilder</span><span class="o">()</span> <span class="o">{}</span>

        <span class="kd">public</span> <span class="nc">User</span><span class="o">.</span><span class="na">UserBuilder</span> <span class="nf">username</span><span class="o">(</span><span class="nc">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">username</span><span class="o">;</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="nc">User</span><span class="o">.</span><span class="na">UserBuilder</span> <span class="nf">password</span><span class="o">(</span><span class="nc">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">password</span> <span class="o">=</span> <span class="n">password</span><span class="o">;</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="nc">User</span> <span class="nf">build</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">User</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">username</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">password</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="s">"User.UserBuilder(username="</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">+</span> <span class="s">", password="</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">password</span> <span class="o">+</span> <span class="s">")"</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="2-builder-ä¸­ä½¿ç”¨-singular-æ³¨é‡Šé›†åˆ">2. @Builder ä¸­ä½¿ç”¨ @Singular æ³¨é‡Šé›†åˆ</h3>

<p>2.1 @Singular å®æˆ˜ä½¿ç”¨</p>

<p>@Builderä¹Ÿå¯ä»¥ä¸ºé›†åˆç±»å‹çš„å‚æ•°æˆ–å­—æ®µç”Ÿæˆä¸€ç§ç‰¹æ®Šçš„æ–¹æ³•ã€‚ å®ƒé‡‡ç”¨ä¿®æ”¹åˆ—è¡¨ä¸­ä¸€ä¸ªå…ƒç´ è€Œä¸æ˜¯æ•´ä¸ªåˆ—è¡¨çš„æ–¹å¼ï¼Œå¯ä»¥æ˜¯å¢åŠ ä¸€ä¸ªå…ƒç´ ï¼Œä¹Ÿå¯ä»¥æ˜¯åˆ é™¤ä¸€ä¸ªå…ƒç´ ã€‚ ä¾‹å¦‚ï¼š</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Person</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
    <span class="o">.</span><span class="na">job</span><span class="o">(</span><span class="s">"Mythbusters"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">job</span><span class="o">(</span><span class="s">"Unchained Reaction"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</code></pre></div></div>
<p>è¿™æ ·å°±å¯ä»¥è½»æ¾åœ°å°†List <String>å­—æ®µä¸­åŒ…å«2ä¸ªå­—ç¬¦ä¸²ã€‚ ä½†æ˜¯æƒ³è¦è¿™æ ·æ¥æ“ä½œé›†åˆï¼Œä½ éœ€è¦ä½¿ç”¨@Singularæ¥æ³¨é‡Šå­—æ®µæˆ–å‚æ•°ã€‚</String></p>

<p>åœ¨ä½¿ç”¨@Singularæ³¨é‡Šæ³¨é‡Šä¸€ä¸ªé›†åˆå­—æ®µï¼ˆä½¿ç”¨@Builderæ³¨é‡Šç±»ï¼‰ï¼Œlombokä¼šå°†è¯¥æ„å»ºå™¨èŠ‚ç‚¹è§†ä¸ºä¸€ä¸ªé›†åˆï¼Œå¹¶ç”Ÿæˆä¸¤ä¸ªadderæ–¹æ³•è€Œä¸æ˜¯setteræ–¹æ³•ã€‚</p>

<ul>
  <li>ä¸€ä¸ªå‘é›†åˆæ·»åŠ å•ä¸ªå…ƒç´ ï¼Œ</li>
  <li>
    <p>ä¸€ä¸ªå°†å¦ä¸€ä¸ªé›†åˆçš„æ‰€æœ‰å…ƒç´ æ·»åŠ åˆ°é›†åˆä¸­ã€‚
å°†ä¸ç”Ÿæˆä»…è®¾ç½®é›†åˆï¼ˆæ›¿æ¢å·²æ·»åŠ çš„ä»»ä½•å†…å®¹ï¼‰çš„setterã€‚ è¿˜ç”Ÿæˆäº†clearæ–¹æ³•ã€‚ è¿™äº›singularæ„å»ºå™¨ç›¸å¯¹è€Œè¨€æ˜¯æœ‰äº›å¤æ‚çš„ï¼Œä¸»è¦æ˜¯æ¥ä¿è¯ä»¥ä¸‹ç‰¹æ€§ï¼š</p>
  </li>
  <li>åœ¨è°ƒç”¨build()æ—¶ï¼Œç”Ÿæˆçš„é›†åˆå°†æ˜¯ä¸å¯å˜çš„ã€‚</li>
  <li>åœ¨è°ƒç”¨build()ä¹‹åè°ƒç”¨å…¶ä¸­ä¸€ä¸ªadderæ–¹æ³•æˆ–clearæ–¹æ³•ä¸ä¼šä¿®æ”¹ä»»ä½•å·²ç»ç”Ÿæˆçš„å¯¹è±¡ã€‚å¦‚æœå¯¹é›†åˆä¿®æ”¹ä¹‹åï¼Œå†è°ƒç”¨build()ï¼Œåˆ™ä¼šåˆ›å»ºä¸€ä¸ªåŸºäºä¸Šä¸€ä¸ªå¯¹è±¡åˆ›å»ºçš„å¯¹è±¡å®ä½“ã€‚</li>
  <li>
    <p>ç”Ÿæˆçš„é›†åˆå°†è¢«å‹ç¼©åˆ°æœ€å°çš„å¯è¡Œæ ¼å¼ï¼ŒåŒæ—¶ä¿æŒé«˜æ•ˆã€‚
@Singularåªèƒ½åº”ç”¨äºlombokå·²çŸ¥çš„é›†åˆç±»å‹ã€‚ç›®å‰ï¼Œæ”¯æŒçš„ç±»å‹æœ‰ï¼š</p>
  </li>
  <li>java.util:
    <ul>
      <li>Iterable, Collection, å’ŒList (ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç”±å‹ç¼©çš„ä¸å¯ä¿®æ”¹çš„ArrayListæ”¯æŒ).</li>
      <li>Set, SortedSet, and NavigableSet (ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç”Ÿæˆå¯å˜å¤§å°ä¸å¯ä¿®æ”¹çš„HashSetæˆ–è€…TreeSet).</li>
      <li>Map, SortedMap, and NavigableMap (ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç”Ÿæˆå¯å˜å¤§å°ä¸å¯ä¿®æ”¹çš„HashMapæˆ–è€…TreeMap).</li>
    </ul>
  </li>
  <li>Guavaâ€™s com.google.common.collect:
    <ul>
      <li>ImmutableCollection and ImmutableList</li>
      <li>ImmutableSet and ImmutableSortedSet</li>
      <li>ImmutableMap, ImmutableBiMap, and ImmutableSortedMap</li>
      <li>ImmutableTable
å†æ¥çœ‹çœ‹ä½¿ç”¨äº†@Singularæ³¨è§£ä¹‹åçš„ç¼–è¯‘æƒ…å†µï¼š
```java
@Builder
public class User {
private final Integer id;
private final String zipCode = â€œ215500â€;
private String username;
private String password;
@Singular
private List<String> hobbies;
}</String></li>
    </ul>
  </li>
</ul>

<p>// ç¼–è¯‘åï¼š
public class User {
    private final Integer id;
    private final String zipCode = â€œ215500â€;
    private String username;
    private String password;
    private List<String> hobbies;
    User(Integer id, String username, String password, List<String> hobbies) {
        this.id = id; this.username = username;
        this.password = password; this.hobbies = hobbies;
    }</String></String></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public static User.UserBuilder builder() {return new User.UserBuilder();}

public static class UserBuilder {
    private Integer id;
    private String username;
    private String password;
    private ArrayList&lt;String&gt; hobbies;
    UserBuilder() {}
    public User.UserBuilder id(Integer id) { this.id = id; return this; }
    public User.UserBuilder username(String username) { this.username = username; return this; }
    public User.UserBuilder password(String password) { this.password = password; return this; }

    public User.UserBuilder hobby(String hobby) {
        if (this.hobbies == null) {
            this.hobbies = new ArrayList();
        }
        this.hobbies.add(hobby);
        return this;
    }

    public User.UserBuilder hobbies(Collection&lt;? extends String&gt; hobbies) {
        if (this.hobbies == null) {
            this.hobbies = new ArrayList();
        }
        this.hobbies.addAll(hobbies);
        return this;
    }

    public User.UserBuilder clearHobbies() {
        if (this.hobbies != null) {
            this.hobbies.clear();
        }
        return this;
    }

    public User build() {
        List hobbies;
        switch(this.hobbies == null ? 0 : this.hobbies.size()) {
        case 0:
            hobbies = Collections.emptyList();
            break;
        case 1:
            hobbies = Collections.singletonList(this.hobbies.get(0));
            break;
        default:
            hobbies = Collections.unmodifiableList(new ArrayList(this.hobbies));
        }
        return new User(this.id, this.username, this.password, hobbies);
    }
    public String toString() {
        return "User.UserBuilder(id=" + this.id + ", username=" + this.username + ", password=" + this.password + ", hobbies=" + this.hobbies + ")";
    }
} } ```
</code></pre></div></div>

<p>å…¶å®ï¼Œlombokçš„åˆ›ä½œè€…è¿˜æ˜¯å¾ˆç”¨å¿ƒçš„ï¼Œåœ¨è¿›è¡Œbuild()æ¥åºŠå»ºå®ä¾‹å¯¹è±¡æ—¶ï¼Œå¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨Collections.unmodifiableList(Collection)æ­¤æ–¹æ³•æ¥åºŠæ¶å®ä¾‹ï¼Œè€Œæ˜¯åˆ†ä¸ºä¸‰ç§æƒ…å†µï¼Œ</p>

<ul>
  <li>ç¬¬ä¸€ç§ï¼Œå½“é›†åˆä¸­æ²¡æœ‰å…ƒç´ æ—¶ï¼Œåˆ›å»ºä¸€ä¸ªç©ºlistï¼›</li>
  <li>ç¬¬äºŒç§æƒ…å†µï¼Œå½“é›†åˆä¸­å­˜åœ¨ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œåˆ›å»ºä¸€ä¸ªä¸å¯å˜çš„å•å…ƒç´ listï¼›</li>
  <li>
    <p>ç¬¬ä¸‰ç§æƒ…å†µï¼Œæ ¹æ®å½“å‰é›†åˆçš„å…ƒç´ æ•°é‡åˆ›å»ºå¯¹åº”åˆé€‚å¤§å°çš„listï¼›
å½“ç„¶æˆ‘ä»¬çœ‹ç¼–è¯‘ç”Ÿæˆçš„ä»£ç ï¼Œåˆ›å»ºäº†ä¸‰ä¸ªå…³äºé›†åˆæ“ä½œçš„æ–¹æ³•ï¼š</p>
  </li>
  <li>hobby(String hobby)ï¼šå‘é›†åˆä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´ </li>
  <li>hobbies(Collection&lt;? extends String&gt; hobbies)ï¼šæ·»åŠ ä¸€ä¸ªé›†åˆæ‰€æœ‰çš„å…ƒç´ </li>
  <li>clearHobbies()ï¼šæ¸…ç©ºå½“å‰é›†åˆæ•°æ®
2.2 @Singular æ³¨è§£é…ç½®è¯¦è§£</li>
</ul>

<p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ @Singular æ³¨è§£çš„è¯¦æƒ…ï¼š</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Target</span><span class="o">({</span><span class="no">FIELD</span><span class="o">,</span> <span class="no">PARAMETER</span><span class="o">})</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="no">SOURCE</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">Singular</span> <span class="o">{</span>
	<span class="c1">// ä¿®æ”¹æ·»åŠ é›†åˆå…ƒç´ çš„æ–¹æ³•å</span>
	<span class="nc">String</span> <span class="nf">value</span><span class="o">()</span> <span class="k">default</span> <span class="s">""</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>æµ‹è¯•å¦‚ä½•ä½¿ç”¨æ³¨è§£å±æ€§vlaue</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Builder</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">zipCode</span> <span class="o">=</span> <span class="s">"215500"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">username</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">password</span><span class="o">;</span>
    <span class="nd">@Singular</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"testHobbies"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">hobbies</span><span class="o">;</span>
<span class="o">}</span>

<span class="c1">// æµ‹è¯•ç±»</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BuilderTest</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="nc">User</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">testHobbies</span><span class="o">(</span><span class="s">"reading"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">testHobbies</span><span class="o">(</span><span class="s">"chatting"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">id</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
                <span class="o">.</span><span class="na">password</span><span class="o">(</span><span class="s">"jdkong"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">username</span><span class="o">(</span><span class="s">"jdkong"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>è¯´æ˜ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨äº†æ³¨è§£å±æ€§valueä¹‹åï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨æ·»åŠ é›†åˆå…ƒç´ æ—¶çš„æ–¹æ³•åå‘ç”Ÿç›¸åº”çš„æ”¹å˜ã€‚ä½†æ˜¯ï¼ŒåŒæ—¶ç”Ÿæˆçš„æ·»åŠ æ•´ä¸ªé›†åˆçš„æ–¹æ³•åå‘ç”Ÿæ”¹å˜äº†å—ï¼Ÿæˆ‘ä»¬å†æ¥çœ‹çœ‹ç¼–è¯‘åçš„ä»£ç ï¼š</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ç¼–è¯‘åï¼š</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
	<span class="c1">// çœç•¥éƒ¨åˆ†ä»£ç ï¼Œåªçœ‹å…³é”®éƒ¨åˆ†</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">UserBuilder</span> <span class="o">{</span>
		<span class="kd">public</span> <span class="nc">User</span><span class="o">.</span><span class="na">UserBuilder</span> <span class="nf">testHobbies</span><span class="o">(</span><span class="nc">String</span> <span class="n">testHobbies</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">hobbies</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">hobbies</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="k">this</span><span class="o">.</span><span class="na">hobbies</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">testHobbies</span><span class="o">);</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="nc">User</span><span class="o">.</span><span class="na">UserBuilder</span> <span class="nf">hobbies</span><span class="o">(</span><span class="nc">Collection</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">hobbies</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">hobbies</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">hobbies</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="k">this</span><span class="o">.</span><span class="na">hobbies</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">hobbies</span><span class="o">);</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="nc">User</span><span class="o">.</span><span class="na">UserBuilder</span> <span class="nf">clearHobbies</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">hobbies</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">hobbies</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>å¯ä»¥çœ‹åˆ°ï¼Œåªæœ‰æ·»åŠ ä¸€ä¸ªå…ƒç´ çš„æ–¹æ³•åå‘ç”Ÿäº†æ”¹å˜ã€‚</p>

<h3 id="3-builderdefault-ä½¿ç”¨">3. @Builder.Default ä½¿ç”¨</h3>

<p>æ¯”å¦‚æœ‰è¿™æ ·ä¸€ä¸ªå®ä½“ç±»ï¼š</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Builder</span>
<span class="nd">@ToString</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
    <span class="nd">@Builder</span><span class="o">.</span><span class="na">Default</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">id</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">username</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">password</span><span class="o">;</span>
    <span class="nd">@Builder</span><span class="o">.</span><span class="na">Default</span>
    <span class="kd">private</span> <span class="kt">long</span> <span class="n">insertTime</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>åœ¨ç±»ä¸­æˆ‘åœ¨idå’ŒinsertTimeä¸Šéƒ½æ·»åŠ æ³¨è§£@Builder.Defaultï¼Œå½“æˆ‘åœ¨ä½¿ç”¨è¿™ä¸ªå®ä½“å¯¹è±¡æ—¶ï¼Œæˆ‘å°±ä¸éœ€è¦åœ¨ä¸ºè¿™ä¸¤ä¸ªå­—æ®µè¿›è¡Œåˆå§‹åŒ–å€¼ï¼Œå¦‚ä¸‹é¢è¿™æ ·ï¼š</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BuilderTest</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="nc">User</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">password</span><span class="o">(</span><span class="s">"jdkong"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">username</span><span class="o">(</span><span class="s">"jdkong"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// è¾“å‡ºå†…å®¹ï¼š</span>
<span class="nc">User</span><span class="o">(</span><span class="n">id</span><span class="o">=</span><span class="mi">416219</span><span class="n">e1</span><span class="o">-</span><span class="n">bc64</span><span class="o">-</span><span class="mi">43</span><span class="n">fd</span><span class="o">-</span><span class="n">b2c3</span><span class="o">-</span><span class="mi">9</span><span class="n">f8dc109c2e8</span><span class="o">,</span> <span class="n">username</span><span class="o">=</span><span class="n">jdkong</span><span class="o">,</span> <span class="n">password</span><span class="o">=</span><span class="n">jdkong</span><span class="o">,</span> <span class="n">insertTime</span><span class="o">=</span><span class="mi">1546869309868</span><span class="o">)</span>
</code></pre></div></div>

<p>lombokåœ¨å®ä¾‹åŒ–å¯¹è±¡æ—¶å°±ä¸ºæˆ‘ä»¬åˆå§‹åŒ–äº†è¿™ä¸¤ä¸ªå­—æ®µå€¼ã€‚</p>

<p>å½“ç„¶ï¼Œä½ å¦‚æœå†å¯¹è¿™ä¸¤ä¸ªå­—æ®µè¿›è¡Œè®¾å€¼çš„è¯ï¼Œé‚£ä¹ˆé»˜è®¤å®šä¹‰çš„å€¼å°†ä¼šè¢«è¦†ç›–æ‰ï¼Œå¦‚ä¸‹é¢è¿™æ ·ï¼š</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BuilderTest</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="nc">User</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">id</span><span class="o">(</span><span class="s">"jdkong"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">password</span><span class="o">(</span><span class="s">"jdkong"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">username</span><span class="o">(</span><span class="s">"jdkong"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">// è¾“å‡ºå†…å®¹</span>
<span class="nc">User</span><span class="o">(</span><span class="n">id</span><span class="o">=</span><span class="n">jdkong</span><span class="o">,</span> <span class="n">username</span><span class="o">=</span><span class="n">jdkong</span><span class="o">,</span> <span class="n">password</span><span class="o">=</span><span class="n">jdkong</span><span class="o">,</span> <span class="n">insertTime</span><span class="o">=</span><span class="mi">1546869642151</span><span class="o">)</span>
</code></pre></div></div>
<h3 id="4-builder-è¯¦ç»†é…ç½®">4. @Builder è¯¦ç»†é…ç½®</h3>

<p>ä¸‹é¢æˆ‘ä»¬å†æ¥è¯¦ç»†çœ‹çœ‹@Builderè¿™ä¸ªæ³¨è§£ç±»åœ°è¯¦ç»†å®ç°ï¼š</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Target</span><span class="o">({</span><span class="no">TYPE</span><span class="o">,</span> <span class="no">METHOD</span><span class="o">,</span> <span class="no">CONSTRUCTOR</span><span class="o">})</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="no">SOURCE</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">Builder</span> <span class="o">{</span>
	<span class="c1">// å¦‚æœ@Builderæ³¨è§£åœ¨ç±»ä¸Šï¼Œå¯ä»¥ä½¿ç”¨ @Builder.DefaultæŒ‡å®šåˆå§‹åŒ–è¡¨è¾¾å¼</span>
	<span class="nd">@Target</span><span class="o">(</span><span class="no">FIELD</span><span class="o">)</span>
	<span class="nd">@Retention</span><span class="o">(</span><span class="no">SOURCE</span><span class="o">)</span>
	<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">Default</span> <span class="o">{}</span>
	<span class="c1">// æŒ‡å®šå®ä½“ç±»ä¸­åˆ›å»º Builder çš„æ–¹æ³•çš„åç§°ï¼Œé»˜è®¤ä¸º: builder (ä¸ªäººè§‰å¾—æ²¡å¿…è¦ä¿®æ”¹)</span>
	<span class="nc">String</span> <span class="nf">builderMethodName</span><span class="o">()</span> <span class="k">default</span> <span class="s">"builder"</span><span class="o">;</span>
	<span class="c1">// æŒ‡å®š Builder ä¸­ç”¨æ¥æ„ä»¶å®ä½“ç±»çš„æ–¹æ³•çš„åç§°ï¼Œé»˜è®¤ä¸ºï¼šbuild (ä¸ªäººè§‰å¾—æ²¡å¿…è¦ä¿®æ”¹)</span>
	<span class="nc">String</span> <span class="nf">buildMethodName</span><span class="o">()</span> <span class="k">default</span> <span class="s">"build"</span><span class="o">;</span>
	<span class="c1">// æŒ‡å®šåˆ›å»ºçš„å»ºé€ è€…ç±»çš„åç§°ï¼Œé»˜è®¤ä¸ºï¼šå®ä½“ç±»å+Builder</span>
	<span class="nc">String</span> <span class="nf">builderClassName</span><span class="o">()</span> <span class="k">default</span> <span class="s">""</span><span class="o">;</span>
	<span class="c1">// ä½¿ç”¨toBuilderå¯ä»¥å®ç°ä»¥ä¸€ä¸ªå®ä¾‹ä¸ºåŸºç¡€ç»§ç»­åˆ›å»ºä¸€ä¸ªå¯¹è±¡ã€‚ï¼ˆä¹Ÿå°±æ˜¯é‡ç”¨åŸæ¥å¯¹è±¡çš„å€¼ï¼‰</span>
	<span class="kt">boolean</span> <span class="nf">toBuilder</span><span class="o">()</span> <span class="k">default</span> <span class="kc">false</span><span class="o">;</span>

	<span class="nd">@Target</span><span class="o">({</span><span class="no">FIELD</span><span class="o">,</span> <span class="no">PARAMETER</span><span class="o">})</span>
	<span class="nd">@Retention</span><span class="o">(</span><span class="no">SOURCE</span><span class="o">)</span>
	<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">ObtainVia</span> <span class="o">{</span>
		<span class="c1">// å‘Šè¯‰lombokä½¿ç”¨è¡¨è¾¾å¼è·å–å€¼</span>
		<span class="nc">String</span> <span class="nf">field</span><span class="o">()</span> <span class="k">default</span> <span class="s">""</span><span class="o">;</span>
		<span class="c1">// å‘Šè¯‰lombokä½¿ç”¨è¡¨è¾¾å¼è·å–å€¼</span>
		<span class="nc">String</span> <span class="nf">method</span><span class="o">()</span> <span class="k">default</span> <span class="s">""</span><span class="o">;</span>

		<span class="kt">boolean</span> <span class="nf">isStatic</span><span class="o">()</span> <span class="k">default</span> <span class="kc">false</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ä»¥ä¸Šæ³¨è§£å±æ€§ï¼Œæˆ‘åªæµ‹è¯•ä¸€ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„toBuilderï¼Œå› ä¸ºæˆ‘ä»¬åœ¨å¯¹å®ä½“å¯¹è±¡è¿›è¡Œæ“ä½œæ—¶ï¼Œå¾€å¾€ä¼šå­˜åœ¨å¯¹æŸäº›å®ä½“å¯¹è±¡çš„æŸä¸ªå­—æ®µè¿›è¡ŒäºŒæ¬¡èµ‹å€¼ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šç”¨åˆ°è¿™ä¸€å±æ€§ã€‚ä½†æ˜¯ï¼Œè¿™ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯åŸæ¥çš„å¯¹è±¡ï¼ŒåŸæ¥çš„å¯¹è±¡å±æ€§æ˜¯ä¸å¯å˜çš„ï¼Œé™¤éä½ è‡ªå·±æƒ³è¦ç»™è¿™ä¸ªå®ä½“ç±»å†æ·»åŠ ä¸Š@Dataæˆ–è€…@setteræ–¹æ³•ï¼ˆæˆ‘æ˜¯è¿™ä¹ˆå¹²è¿‡ï¼Œå“ˆå“ˆï¼‰ã€‚ä¸‹é¢å°±æ¥æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Builder</span><span class="o">(</span><span class="n">toBuilder</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="nd">@ToString</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">username</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">password</span><span class="o">;</span>
<span class="o">}</span>
<span class="c1">// æµ‹è¯•ç±»</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BuilderTest</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">User</span> <span class="n">user1</span> <span class="o">=</span> <span class="nc">User</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">password</span><span class="o">(</span><span class="s">"jdkong"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">username</span><span class="o">(</span><span class="s">"jdkong"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user1</span><span class="o">);</span>

        <span class="nc">User</span> <span class="n">user2</span> <span class="o">=</span> <span class="n">user1</span><span class="o">.</span><span class="na">toBuilder</span><span class="o">().</span><span class="na">username</span><span class="o">(</span><span class="s">"jdkong2"</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
        <span class="c1">// éªŒè¯user2æ˜¯å¦æ˜¯åŸºäºuser1çš„ç°æœ‰å±æ€§åˆ›å»ºçš„</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user2</span><span class="o">);</span>
        <span class="c1">// éªŒè¯å¯¹è±¡æ˜¯å¦æ˜¯åŒä¸€å¯¹è±¡</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user1</span> <span class="o">==</span> <span class="n">user2</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">// è¾“å‡ºå†…å®¹</span>
<span class="nc">User</span><span class="o">(</span><span class="n">username</span><span class="o">=</span><span class="n">jdkong</span><span class="o">,</span> <span class="n">password</span><span class="o">=</span><span class="n">jdkong</span><span class="o">)</span>
<span class="nc">User</span><span class="o">(</span><span class="n">username</span><span class="o">=</span><span class="n">jdkong2</span><span class="o">,</span> <span class="n">password</span><span class="o">=</span><span class="n">jdkong</span><span class="o">)</span>
<span class="kc">false</span>
</code></pre></div></div>

<ol>
  <li>@Builder å…¨å±€é…ç½®
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="n">æ˜¯å¦ç¦æ­¢ä½¿ç”¨</span><span class="nd">@Builder</span>
<span class="n">lombok</span><span class="o">.</span><span class="na">builder</span><span class="o">.</span><span class="na">flagUsage</span> <span class="o">=</span> <span class="o">[</span><span class="n">warning</span> <span class="o">|</span> <span class="n">error</span><span class="o">]</span> <span class="o">(</span><span class="k">default</span><span class="o">:</span> <span class="n">not</span> <span class="n">set</span><span class="o">)</span>
<span class="err">#</span><span class="n">æ˜¯å¦ä½¿ç”¨Guaua</span>
<span class="n">lombok</span><span class="o">.</span><span class="na">singular</span><span class="o">.</span><span class="na">useGuava</span> <span class="o">=</span> <span class="o">[</span><span class="kc">true</span> <span class="o">|</span> <span class="kc">false</span><span class="o">]</span> <span class="o">(</span><span class="k">default</span><span class="o">:</span> <span class="kc">false</span><span class="o">)</span>
<span class="err">#</span> <span class="n">æ˜¯å¦è‡ªåŠ¨ä½¿ç”¨singular</span><span class="err">ï¼Œ</span><span class="n">é»˜è®¤æ˜¯ä½¿ç”¨</span>
<span class="n">lombok</span><span class="o">.</span><span class="na">singular</span><span class="o">.</span><span class="na">auto</span> <span class="o">=</span> <span class="o">[</span><span class="kc">true</span> <span class="o">|</span> <span class="kc">false</span><span class="o">]</span> <span class="o">(</span><span class="k">default</span><span class="o">:</span> <span class="kc">true</span><span class="o">)</span>
</code></pre></div>    </div>
  </li>
</ol>
:ET